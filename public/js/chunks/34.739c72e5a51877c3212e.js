(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{RZZ2:function(a,t,s){"use strict";var e=s("bJaO");var i={fetchUsers:function(a){var t=a.commit;return new Promise((function(a,s){e.a.get("/api/user-management/users").then((function(s){t("SET_USERS",s.data),a(s)})).catch((function(a){s(a)}))}))},fetchUser:function(a,t){return function(a){if(null==a)throw new TypeError("Cannot destructure undefined")}(a),new Promise((function(a,s){e.a.get("/api/user-management/users/".concat(t)).then((function(t){a(t)})).catch((function(a){s(a)}))}))},removeRecord:function(a,t){var s=a.commit;return new Promise((function(a,i){e.a.delete("/api/user-management/users/".concat(t)).then((function(e){s("REMOVE_RECORD",t),a(e)})).catch((function(a){i(a)}))}))}};t.a={isRegistered:!1,namespaced:!0,state:{users:[]},mutations:{SET_USERS:function(a,t){a.users=t},REMOVE_RECORD:function(a,t){var s=a.users.findIndex((function(a){return a.id==t}));a.users.splice(s,1)}},actions:i,getters:{}}},Vqpr:function(a,t,s){"use strict";s.r(t);var e=s("Snq/"),i={components:{vSelect:s.n(e).a},props:{data:{type:Object,required:!0}},data:function(){return{data_local:JSON.parse(JSON.stringify(this.data)),statusOptions:[{label:"Activo",value:1},{label:"Inactivo",value:0}],empresa:"ESGRYMA CONSULTING GROUP",imagen:null,permisos:[],roles:[],permisosAsociados:[],rolesAsociados:[],tempRolesAsignados:[],rolesAgregar:[],rolesEliminar:[]}},computed:{},created:function(){this.consultarPermisos(),this.consultarRoles(),this.permisosUsuarios(),this.rolesUsuarios()},methods:{save_changes:function(){},reset_data:function(){this.data_local=JSON.parse(JSON.stringify(this.data))},update_avatar:function(a){this.imagen=a.target.files[0],this.$vs.dialog({type:"confirm",color:"warning",title:"Actualizar imagen",text:"Desea actualizar la imagen de perfil ?",accept:this.actualizarImagen,acceptText:"Actualizar"})},actualizarImagen:function(){var a=new FormData;a.append("imagen",this.imagen),a.append("id",this.data_local.id),axios.post("/maestros/actualizarImagen",a,{headers:{"content-type":"multipart/form-data"}}).then((function(a){location.reload()}))},guardarCambiosUsuario:function(){var a=this,t={id:this.data_local.id,name:this.data_local.nombre,email:this.data_local.email,activo:this.data_local.activo,tipo_usuario:this.data_local.tipo_usuario};this.activeLoading=!0,axios.post("/maestros/guardarDatosUsuario",{datoUsuario:t,rolesAgregar:this.rolesAgregar,rolesEliminar:this.rolesEliminar}).then((function(t){a.mostrarNotificacion("Actualizar usuario","Datos actualizados con exito!","success"),a.activeLoading=!1,location.reload()}))},buscarImagen:function(){$("#imagen").click()},preguntarEliminarFoto:function(){this.$vs.dialog({type:"confirm",color:"warning",title:"Eliminar foto de perfil",text:"Desea eliminar la imagen de perfil ?",accept:this.guardarEliminarImagen,acceptText:"Eliminar"})},guardarEliminarImagen:function(){var a=this;this.activeLoading=!0,axios.post("/maestros/eliminarFoto",{id:this.data_local.id}).then((function(t){a.activeLoading=!1,location.reload()}))},consultarPermisos:function(){var a=this;axios.post("/maestros/listaPermisos").then((function(t){a.permisos=t.data}))},consultarRoles:function(){var a=this;axios.post("/maestros/listaRoles").then((function(t){a.roles=t.data}))},permisosUsuarios:function(){var a=this;axios.post("/maestros/permisosUsuario",{id:this.data_local.id}).then((function(t){var s=a;$.each(t.data,(function(a,t){s.permisosAsociados.push(t.id)}))}))},rolesUsuarios:function(){var a=this;axios.post("/maestros/rolesUsuario",{id:this.data_local.id}).then((function(t){var s=a;$.each(t.data,(function(a,t){s.rolesAsociados.push(t.id),s.tempRolesAsignados.push(t.id)}))}))},validarRolesCheck:function(){var a=this;this.rolesAgregar=[],this.rolesEliminar=[],$.each(this.rolesAsociados,(function(t,s){-1==a.tempRolesAsignados.findIndex((function(a){return a==s}))&&a.rolesAgregar.push(s)})),$.each(this.tempRolesAsignados,(function(t,s){-1==a.rolesAsociados.findIndex((function(a){return a==s}))&&a.rolesEliminar.push(s)}))}}},o=s("KHd+"),r=Object(o.a)(i,(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{attrs:{id:"user-edit-tab-info"}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col w-full"},[s("div",{staticClass:"flex items-start flex-col sm:flex-row"},[s("vs-avatar",{staticClass:"mr-4 mb-4",attrs:{src:a.data.imagen,size:"70px"}}),a._v(" "),s("div",[s("p",{staticClass:"text-lg font-medium mb-2 mt-4 sm:mt-0"},[a._v(a._s(a.data.nombre))]),a._v(" "),s("input",{ref:"update_avatar_input",staticClass:"hidden",attrs:{type:"file",id:"imagen",accept:"image/*"},on:{change:a.update_avatar}}),a._v(" "),s("boton",{staticClass:"mr-4 mb-4",attrs:{texto_cargando:"Guardando imagen...",texto:"Actualizar foto",cargando:a.activeLoading},nativeOn:{click:function(t){return a.buscarImagen(t)}}}),a._v(" "),""!=a.data_local.imagen&&null!=a.data_local.imagen?s("boton",{staticClass:"mr-4 mb-4 vs-button vs-button-danger vs-button-border",attrs:{texto_cargando:"Eliminando imagen...",texto:"",cargando:a.activeLoading},nativeOn:{click:function(t){return a.preguntarEliminarFoto(t)}}},[a._v("\n                        Eliminar foto\n                    ")]):a._e()],1)],1)])]),a._v(" "),s("ValidationObserver",{ref:"form"},[s("form",{on:{submit:function(t){return t.preventDefault(),a.guardarCambiosUsuario(t)}}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col sm:w-12/12 md:w-6/12 lg:w-6/12 w-full"},[s("validation-provider",{attrs:{name:"NOMBRE",rules:"required"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-input",{staticClass:"w-full mt-4",attrs:{label:"Nombre completo",name:"nombre"},model:{value:a.data_local.nombre,callback:function(t){a.$set(a.data_local,"nombre",t)},expression:"data_local.nombre"}}),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])})],1),a._v(" "),s("div",{staticClass:"vx-col sm:w-12/12 md:w-6/12 lg:w-6/12 w-full"},[s("validation-provider",{attrs:{name:"EMAIL",rules:"required|email"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-input",{staticClass:"w-full mt-4",attrs:{label:"Correo",type:"email",name:"email"},model:{value:a.data_local.email,callback:function(t){a.$set(a.data_local,"email",t)},expression:"data_local.email"}}),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])})],1),a._v(" "),s("div",{staticClass:"vx-col sm:w-12/12 md:w-4/12 lg:w-4/12 w-full"},[s("validation-provider",{attrs:{name:"TIPO USUARIO",rules:"required"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-input",{staticClass:"w-full mt-4",attrs:{label:"Tipo usuario",name:"tipo_usuario"},model:{value:a.data_local.tipo_usuario,callback:function(t){a.$set(a.data_local,"tipo_usuario",t)},expression:"data_local.tipo_usuario"}}),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])})],1),a._v(" "),s("div",{staticClass:"vx-col sm:w-12/12 md:w-4/12 lg:w-4/12 w-full"},[s("vs-input",{staticClass:"w-full mt-4",attrs:{label:"Empresa",name:"empresa"},model:{value:a.empresa,callback:function(t){a.empresa=t},expression:"empresa"}})],1),a._v(" "),s("div",{staticClass:"vx-col sm:w-12/12 md:w-4/12 lg:w-4/12 w-full mt-4"},[s("label",[a._v("Activo")]),a._v(" "),s("validation-provider",{attrs:{name:"ACTIVO",rules:"required|email"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-switch",{model:{value:a.data_local.activo,callback:function(t){a.$set(a.data_local,"activo",t)},expression:"data_local.activo"}},[s("span",{attrs:{slot:"on"},slot:"on"},[a._v("SI")]),a._v(" "),s("span",{attrs:{slot:"off"},slot:"off"},[a._v("NO")])]),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])})],1)]),a._v(" "),s("vx-card",{staticClass:"mt-base",attrs:{"no-shadow":"","card-border":""}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col w-full"},[s("div",{staticClass:"flex items-end px-3"},[s("feather-icon",{staticClass:"mr-2",attrs:{svgClasses:"w-6 h-6",icon:"LockIcon"}}),a._v(" "),s("span",{staticClass:"font-medium text-lg leading-none"},[a._v("Permisos")])],1),a._v(" "),s("vs-divider")],1)]),a._v(" "),s("div",{staticClass:"block overflow-x-auto"},[s("table",{staticClass:"w-full"},[s("tr",a._l(["Permiso","Agregar"],(function(t){return s("th",{key:t,staticClass:"font-semibold text-base text-left px-3 py-2"},[a._v(a._s(t)+"\n                            ")])})),0),a._v(" "),a._l(a.permisos,(function(t,e){return s("tr",{key:a.name},[s("td",{staticClass:"px-3 py-2"},[a._v(a._s(t.name))]),a._v(" "),s("td",{key:e,staticClass:"px-3 py-2"},[s("vs-checkbox",{attrs:{"vs-value":t.id},model:{value:a.permisosAsociados,callback:function(t){a.permisosAsociados=t},expression:"permisosAsociados"}})],1)])}))],2)])]),a._v(" "),s("vx-card",{staticClass:"mt-base",attrs:{"no-shadow":"","card-border":""}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col w-full"},[s("div",{staticClass:"flex items-end px-3"},[s("feather-icon",{staticClass:"mr-2",attrs:{svgClasses:"w-6 h-6",icon:"LockIcon"}}),a._v(" "),s("span",{staticClass:"font-medium text-lg leading-none"},[a._v("Roles")])],1),a._v(" "),s("vs-divider")],1)]),a._v(" "),s("div",{staticClass:"block overflow-x-auto"},[s("table",{staticClass:"w-full"},[s("tr",a._l(["Rol","Agregar"],(function(t){return s("th",{key:t,staticClass:"font-semibold text-base text-left px-3 py-2"},[a._v(a._s(t)+"\n                            ")])})),0),a._v(" "),a._l(a.roles,(function(t,e){return s("tr",{key:a.name},[s("td",{staticClass:"px-3 py-2"},[a._v(a._s(t.name))]),a._v(" "),s("td",{key:e,staticClass:"px-3 py-2"},[s("vs-checkbox",{attrs:{"vs-value":t.id},on:{input:a.validarRolesCheck},model:{value:a.rolesAsociados,callback:function(t){a.rolesAsociados=t},expression:"rolesAsociados"}})],1)])}))],2)])]),a._v(" "),s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col w-full"},[s("div",{staticClass:"mt-8 flex flex-wrap items-center justify-end"},[s("boton",{attrs:{texto_cargando:"Guardando datos...",type:"submit",texto:"Guardar datos",cargando:a.activeLoading}})],1)])])],1)])],1)}),[],!1,null,null,null).exports,n=s("RZZ2"),l={props:{usuario:{required:!0,type:[Object,Array]}},data:function(){return{nueva_clave:"",confirmar_clave:""}},computed:{},methods:{actualizarClave:function(){var a=this;this.activeLoading=!0,axios.post("/maestros/actualizarClave",{id:this.usuario.id,clave:this.nueva_clave}).then((function(t){a.activeLoading=!1,a.mostrarNotificacion("Actualización de contraseña","La contraseña se ha actualizado con exito!","success"),a.nueva_clave=a.confirmar_clave=""}))}}},c={components:{ConfiguracionClave:Object(o.a)(l,(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("vx-card",{attrs:{"no-shadow":""}},[s("ValidationObserver",{ref:"form"},[s("form",{on:{submit:function(t){return t.preventDefault(),a.actualizarClave(t)}}},[s("validation-provider",{attrs:{name:"CONTRASEÑA",rules:"required|confirmed:confirmacion|min:8"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-input",{ref:"password",staticClass:"w-full mb-base",attrs:{type:"password","icon-after":"true","label-placeholder":"Contraseña",icon:"vpn_key",name:"clave"},model:{value:a.nueva_clave,callback:function(t){a.nueva_clave=t},expression:"nueva_clave"}}),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])}),a._v(" "),s("validation-provider",{attrs:{name:"REPETIR CONTRASEÑA",rules:"required|min:8",vid:"confirmacion"},scopedSlots:a._u([{key:"default",fn:function(t){var e=t.errors;return[s("vs-input",{staticClass:"w-full mb-base",attrs:{type:"password","icon-after":"true","label-placeholder":"Repetir contraseña",icon:"vpn_key",name:"password"},model:{value:a.confirmar_clave,callback:function(t){a.confirmar_clave=t},expression:"confirmar_clave"}}),a._v(" "),s("span",{staticClass:"text-danger"},[a._v(a._s(e[0]))])]}}])}),a._v(" "),s("div",{staticClass:"flex flex-wrap items-center justify-end"},[s("boton",{staticClass:"ml-auto mt-2",attrs:{texto_cargando:"Guardando nueva clave...",texto:"Actualizar contraseña",cargando:a.activeLoading,type:"submit"}})],1)],1)])],1)}),[],!1,null,null,null).exports,editarInformacionGeneral:r},data:function(){return{user_data:null,user_not_found:!1,activeTab:0}},watch:{activeTab:function(){this.fetch_user_data(this.$route.query.idUser)}},methods:{fetch_user_data:function(a){var t=this;this.cargandoGeneral=!0,axios.post("/maestros/informacionUsuario",{id:a}).then((function(a){t.user_data=a.data[0][0],t.cargandoGeneral=!1}))}},created:function(){n.a.isRegistered||(this.$store.registerModule("userManagement",n.a),n.a.isRegistered=!0),this.fetch_user_data(this.$route.query.idUser)}},u=Object(o.a)(c,(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{attrs:{id:"page-user-edit"}},[s("vs-alert",{attrs:{color:"danger",title:"Usuario no existe",active:a.user_not_found},on:{"update:active":function(t){a.user_not_found=t}}},[s("span",[a._v("Usuario con id: "+a._s(a.$route.query.idUser)+" no existe en nuestros registros. ")]),a._v(" "),s("span",[s("span",[a._v("Ver todos los usuarios ")]),s("router-link",{staticClass:"text-inherit underline",attrs:{to:{name:"maestros.usuarios"}}},[a._v("Todos los usuarios")])],1)]),a._v(" "),a.user_data?s("vx-card",[s("div",{staticClass:"tabs-container px-6 pt-6",attrs:{slot:"no-body"},slot:"no-body"},[s("vs-tabs",{staticClass:"tab-action-btn-fill-conatiner",model:{value:a.activeTab,callback:function(t){a.activeTab=t},expression:"activeTab"}},[s("vs-tab",{attrs:{label:"Información general","icon-pack":"feather",icon:"icon-user"}},[s("div",{staticClass:"tab-text"},[s("editar-informacion-general",{staticClass:"mt-4",attrs:{data:a.user_data}})],1)]),a._v(" "),s("vs-tab",{attrs:{label:"Contraseña","icon-pack":"feather",icon:"icon-info"}},[s("div",{staticClass:"tab-text"},[s("configuracion-clave",{attrs:{usuario:a.user_data}})],1)])],1)],1)]):a._e()],1)}),[],!1,null,null,null);t.default=u.exports}}]);