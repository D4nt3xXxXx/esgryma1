(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{"U+PM":function(e,t,a){"use strict";a.r(t);var i=a("QBvj"),s=a("Snq/"),l=a.n(s),n={name:"planearBloque",components:{AgGridVue:i.AgGridVue,vSelect:l.a},data:function(){return{datos:[],tipoReservaFiltro:"",tipoReservaOpciones:[],clienteFiltro:"",clienteOpciones:[],totalOrdenes:0,totalMonto:0,anio:(new Date).getFullYear(),listaAnio:[],mes:"",filtroMes:"",metaMes:null,metaOriginal:null,planPrevio:null,idPlan:null,meta:null,listaMeses:[],datosPlanFinal:[],validarGuardar:"",searchQuery:"",rowSelection:"multiple",gridApi:null,gridOptions:{},defaultColDef:{sortable:!0,resizable:!0,suppressMenu:!0},columnDefs:[{headerName:"No. Orden",field:"nroOrden",filter:!0,checkboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,headerCheckboxSelection:!0},{headerName:"Tema",field:"temaOrden",filter:!0},{headerName:"Empresa",field:"empresaOrden",filter:!0},{headerName:"Valor Total",field:"valorOrdenTotal",filter:!0,width:120},{headerName:"Días vencimiento",field:"Dias_vencimiento",filter:!0,width:120},{headerName:"Horas",field:"unidadesOrden",filter:!0,width:120,cellClass:"text-center"},{headerName:"Unidades",field:"unidades",filter:!0,cellClass:"text-center"},{headerName:"Tipo",field:"tipo_Reserva",filter:!0},{headerName:"Cliente",field:"nombreCliente",filter:!0},{headerName:"Estado",field:"nomEstado",filter:!0}]}},computed:{usersData:function(){return this.datos},paginationPageSize:function(){return this.gridApi?this.gridApi.paginationGetPageSize():10},totalPages:function(){return this.gridApi?this.gridApi.paginationGetTotalPages():0},currentPage:{get:function(){return this.gridApi?this.gridApi.paginationGetCurrentPage()+1:1},set:function(e){this.gridApi.paginationGoToPage(e-1)}}},methods:{setColumnFilter:function(e,t){var a=null;"all"!==t&&(a={type:"equals",filter:t}),this.gridApi.getFilterInstance(e).setModel(a),this.gridApi.onFilterChanged()},resetColFilters:function(){this.gridApi.setFilterModel(null),this.gridApi.onFilterChanged(),this.tipoReservaOpciones=this.clienteOpciones={label:"All",value:"all"},this.$refs.filterCard.removeRefreshAnimation()},updateSearchQuery:function(e){this.gridApi.setQuickFilter(e)},consultarReservasSinPlan:function(){var e=this;this.cargandoGeneral=!0,axios.post("/planificacion/consultarReservasSinPlan",{mes:this.filtroMes}).then((function(t){e.datos=t.data.datos,e.tipoReservaOpciones=t.data.filtroTipoReserva,e.clienteOpciones=t.data.filtroClientes,e.cargandoGeneral=!1}))},onSelectionChanged:function(e){this.totalOrdenes=e.api.getSelectedNodes().length;var t=e.api.getSelectedNodes(),a=this;this.datosPlanFinal=[],a.totalMonto=0,$.each(t,(function(e,t){a.totalMonto+=t.data.valorOrdenUnit,a.datosPlanFinal.push(t.data)}))},consultarPlanPrevio:function(){var e=this;""!=this.anio&&null!=this.anio&&""!=this.mes&&null!=this.mes?(this.cargandoGeneral=!0,axios.post("/planificacion/consultarPlanPrevio",{anio:this.anio,mes:this.mes}).then((function(t){if("string"!=typeof t.data){console.log(t.data);var a=t.data;e.metaMes=a[0].meta,e.metaOriginal=e.metaMes,e.planPrevio=a[2].planPrevio,e.novedadesHora=parseInt(a[3].horas),e.idPlan=a[4],e.meta=e.metaMes-e.planPrevio,e.validarGuardar=""}else e.mostrarNotificacion("",t.data,"warning"),e.validarGuardar=t.data;e.cargandoGeneral=!1}))):this.mostrarNotificacion("","Debe seleccionar el mes para el plan!","warning")},guardarPlan:function(){var e=this;if(""==this.validarGuardar)if(""!=this.mes&&null!=this.mes)if(this.totalMonto>0){var t=[{planMes:this.mes,planAnio:this.anio,criterio:"DINERO",monto:this.meta,horasDisponibles:0,metaMes:this.metaMes,porARL:0,porComercial:0}];axios.post("/planificacion/guardarPlan",{datosPlan:t,reservas:this.datosPlanFinal}).then((function(t){"ok"==t.data?(e.mostrarNotificacion("Registro exitoso","El plan se ha registrado con exito!","success"),e.$router.push({name:"planeacion.listaPlanes"})):e.mostrarNotificacion("Registro fallido","Error::"+t.data,"error")}))}else this.mostrarNotificacion("","Lo sentimos, no ha seleccionado ninguna reserva!","warning");else this.mostrarNotificacion("","Debe seleccionar el mes para el plan!","warning");else this.mostrarNotificacion("",this.validarGuardar,"warning")},changeAnio:function(){if((new Date).getFullYear()!=this.anio){this.listaMeses=[];for(var e=0;e<this.meses.length;e++)this.listaMeses.push({id:e+1,text:this.meses[e]})}this.consultarPlanPrevio()}},mounted:function(){if(this.gridApi=this.gridOptions.api,this.$vs.rtl){var e=this.$refs.agGridTable.$el.querySelector(".ag-header-container");e.style.left="-"+String(Number(e.style.transform.slice(11,-3))+9)+"px"}this.$refs.filterCard.toggleContent();for(var t=(new Date).getFullYear(),a=t;a<=t+1;a++)this.listaAnio.push({id:a,text:a})},created:function(){for(var e=(new Date).getMonth(),t=e;t<this.meses.length;t++)this.listaMeses.push({id:t+1,text:this.meses[t]});this.filtroMes=e+1,this.consultarReservasSinPlan()},watch:{tipoReservaFiltro:function(e){this.setColumnFilter("tipo_Reserva",e.value)},clienteFiltro:function(e){this.setColumnFilter("nombreCliente",e.value)}}},r=a("KHd+"),o=Object(r.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vx-card",{attrs:{title:"Planeacón en bloque"}},[a("p",[e._v("A continuación seleccione los criterios para planear - asignar las reservas para un periodo especifico:\n        "),a("strong")]),e._v(" "),a("vx-card",{ref:"filterCard",staticClass:"user-list-filters mb-8",attrs:{title:"Filtros",actionButtons:""},on:{refresh:e.resetColFilters,remove:e.resetColFilters}},[a("div",{staticClass:"vx-row"},[a("div",{staticClass:"vx-col md:w-1/4 sm:w-1/2 w-full"},[a("label",{staticClass:"text-sm opacity-75"},[e._v("Tipo reserva")]),e._v(" "),a("v-select",{staticClass:"mb-4 md:mb-0",attrs:{options:e.tipoReservaOpciones,clearable:!1,dir:e.$vs.rtl?"rtl":"ltr"},model:{value:e.tipoReservaFiltro,callback:function(t){e.tipoReservaFiltro=t},expression:"tipoReservaFiltro"}})],1),e._v(" "),a("div",{staticClass:"vx-col md:w-1/4 sm:w-1/2 w-full"},[a("label",{staticClass:"text-sm opacity-75"},[e._v("Cliente")]),e._v(" "),a("v-select",{staticClass:"mb-4 sm:mb-0",attrs:{options:e.clienteOpciones,clearable:!1,dir:e.$vs.rtl?"rtl":"ltr"},model:{value:e.clienteFiltro,callback:function(t){e.clienteFiltro=t},expression:"clienteFiltro"}})],1),e._v(" "),a("div",{staticClass:"vx-col md:w-1/4 sm:w-1/2 w-full"},[a("label",{staticClass:"text-sm opacity-75"},[e._v("Mes")]),e._v(" "),a("vs-select",{staticClass:"selectExample w-full",attrs:{autocomplete:""},on:{change:e.consultarReservasSinPlan},model:{value:e.filtroMes,callback:function(t){e.filtroMes=t},expression:"filtroMes"}},[a("vs-select-item",{key:"",attrs:{value:"",text:"---seleccione---"}}),e._v(" "),e._l(e.meses,(function(e,t){return a("vs-select-item",{key:t,staticClass:"disabledx",attrs:{value:t+1,text:e}})}))],2)],1)])]),e._v(" "),a("div",{staticClass:"vx-card p-6"},[a("div",{staticClass:"flex flex-wrap items-center"},[a("div",{staticClass:"flex-grow"},[a("vs-dropdown",{staticClass:"cursor-pointer",attrs:{"vs-trigger-click":""}},[a("div",{staticClass:"p-4 border border-solid d-theme-border-grey-light rounded-full d-theme-dark-bg cursor-pointer flex items-center justify-between font-medium"},[a("span",{staticClass:"mr-2"},[e._v(e._s(e.currentPage*e.paginationPageSize-(e.paginationPageSize-1))+" - "+e._s(e.usersData.length-e.currentPage*e.paginationPageSize>0?e.currentPage*e.paginationPageSize:e.usersData.length)+" of "+e._s(e.usersData.length))]),e._v(" "),a("feather-icon",{attrs:{icon:"ChevronDownIcon",svgClasses:"h-4 w-4"}})],1),e._v(" "),a("vs-dropdown-menu",[a("vs-dropdown-item",{on:{click:function(t){return e.gridApi.paginationSetPageSize(10)}}},[a("span",[e._v("10")])]),e._v(" "),a("vs-dropdown-item",{on:{click:function(t){return e.gridApi.paginationSetPageSize(20)}}},[a("span",[e._v("20")])]),e._v(" "),a("vs-dropdown-item",{on:{click:function(t){return e.gridApi.paginationSetPageSize(25)}}},[a("span",[e._v("25")])]),e._v(" "),a("vs-dropdown-item",{on:{click:function(t){return e.gridApi.paginationSetPageSize(30)}}},[a("span",[e._v("30")])])],1)],1)],1),e._v(" "),a("vs-input",{staticClass:"sm:mr-4 mr-0 sm:w-auto w-full sm:order-normal order-3 sm:mt-0 mt-4",attrs:{placeholder:"Search..."},on:{input:e.updateSearchQuery},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),e._v(" "),a("ag-grid-vue",{ref:"agGridTable",staticClass:"ag-theme-material w-100 my-4 ag-grid-table",staticStyle:{width:"100%",height:"400px"},attrs:{gridOptions:e.gridOptions,columnDefs:e.columnDefs,defaultColDef:e.defaultColDef,rowData:e.datos,rowSelection:"multiple",colResizeDefault:"shift",animateRows:!0,floatingFilter:!1,pagination:!0,paginationPageSize:e.paginationPageSize,suppressPaginationPanel:!0,enableRtl:e.$vs.rtl,rowSelection:e.rowSelection},on:{"selection-changed":e.onSelectionChanged}}),e._v(" "),a("vs-pagination",{attrs:{total:e.totalPages,max:7},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),e._v(" "),a("vx-card",[a("div",{staticClass:"vx-row"},[a("div",{staticClass:"vx-col sm:w-12/12 md:w-3/12 lg:w-3/12 w-full mb-2"},[a("strong",[e._v("TOTAL ORDENES:")]),e._v(e._s(e.totalOrdenes)+"\n            ")]),e._v(" "),a("div",{staticClass:"vx-col sm:w-12/12 md:w-3/12 lg:w-3/12 w-full mb-2"},[a("strong",[e._v("TOTAL MONTO:")]),e._v(e._s(e.convertirdecimal(e.totalMonto))+"\n            ")]),e._v(" "),a("div",{staticClass:"vx-col sm:w-12/12 md:w-2/12 lg:w-2/12 w-full mb-2"},[a("strong",[e._v("Año:")]),e._v(" "),a("vs-select",{staticClass:"w-full select-large",on:{input:e.changeAnio},model:{value:e.anio,callback:function(t){e.anio=t},expression:"anio"}},e._l(e.listaAnio,(function(e,t){return a("vs-select-item",{key:t,staticClass:"w-full",attrs:{value:e.id,text:e.text}})})),1)],1),e._v(" "),a("div",{staticClass:"vx-col sm:w-12/12 md:w-2/12 lg:w-2/12 w-full mb-2"},[a("strong",[e._v("MES:")]),e._v(" "),a("vs-select",{staticClass:"w-full select-large",on:{input:e.consultarPlanPrevio},model:{value:e.mes,callback:function(t){e.mes=t},expression:"mes"}},e._l(e.listaMeses,(function(e,t){return a("vs-select-item",{key:t,staticClass:"w-full",attrs:{value:e.id,text:e.text}})})),1)],1),e._v(" "),a("div",{staticClass:"vx-col sm:w-12/12 md:w-3/12 lg:w-3/12 w-full mb-2"},[a("vs-button",{on:{click:e.guardarPlan}},[e._v("\n                    Planear\n                ")])],1)])])],1)}),[],!1,null,"49bd2060",null);t.default=o.exports}}]);